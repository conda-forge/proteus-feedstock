From d9ef9a9ab35813aed0fa5b831e30347ffa55f090 Mon Sep 17 00:00:00 2001
From: Jan Janssen <jan-janssen@users.noreply.github.com>
Date: Mon, 6 Jun 2022 09:49:59 -0600
Subject: [PATCH] Replace recordtype with namedlist

---
 Makefile            |  2 +-
 environment-dev.yml |  2 +-
 environment.yml     |  3 +--
 proteus/Context.py  |  6 +++---
 proteus/defaults.py | 26 +++++++++++++-------------
 5 files changed, 19 insertions(+), 20 deletions(-)

diff --git a/Makefile b/Makefile
index 27d0ac1b4f..57016efa67 100644
--- a/Makefile
+++ b/Makefile
@@ -197,7 +197,7 @@ develop: ${PROTEUS_PREFIX}/bin/proteus_env.sh stack/default.yaml ${PROTEUS_PREFI
 	@echo "Installing development version"
 	@echo "************************"
 	$(call show_info)
-	${PROTEUS_ENV} pip install recordtype py2gmsh pytest pytest-xdist pytest-cov nose tables future
+	${PROTEUS_ENV} pip install namedlist py2gmsh pytest pytest-xdist pytest-cov nose tables future
 	${PROTEUS_ENV} ${PROTEUS_DEVELOP_BUILD_CMD}
 	${PROTEUS_ENV} ${PROTEUS_DEVELOP_CMD}
 	@echo "************************"
diff --git a/environment-dev.yml b/environment-dev.yml
index ec0fd6132b..36eaf04a51 100644
--- a/environment-dev.yml
+++ b/environment-dev.yml
@@ -15,6 +15,7 @@ dependencies:
   - mpich =3.4.2
   - mpich-mpicc =3.4.2
   - mpich-mpicxx =3.4.2
+  - namedlist =1.8
   - numpy =1.21.0
   - openblas =0.3.17
   - parmetis =4.0.3
@@ -40,7 +41,6 @@ dependencies:
   - future =0.18.2
   - ipyparallel =6.3.0
   - pillow =8.3.1
-  - recordtype =1.3
   - xtensor-python = 0.25.3
   - git-lfs
   - eigen =3.3.9
diff --git a/environment.yml b/environment.yml
index 076dfe954d..8a9701561a 100644
--- a/environment.yml
+++ b/environment.yml
@@ -5,6 +5,7 @@ channels:
 dependencies:
   - proteus
   - petsc4py
+  - namedlist
   - notebook
   - future
   - ipyparallel
@@ -12,5 +13,3 @@ dependencies:
   - pillow
   - pip
   - xtensor-python
-  - pip:
-    - recordtype
diff --git a/proteus/Context.py b/proteus/Context.py
index aad2b25129..98e7b2f530 100644
--- a/proteus/Context.py
+++ b/proteus/Context.py
@@ -27,7 +27,7 @@
 """
 from __future__ import print_function
 from collections import  namedtuple
-from recordtype import recordtype
+from namedlist import namedlist
 
 from .Profiling import logEvent
 
@@ -55,7 +55,7 @@ def setFromModule(moduleIn,mutable=False):
         if  key[:2] != "__":
             fields[key]=value
     if mutable:
-        Context = recordtype(moduleIn.__name__.split('.')[-1], iter(fields.items()))
+        Context = namedlist(moduleIn.__name__.split('.')[-1], iter(fields.items()))
         context = Context()
     else:
         Context = namedtuple(moduleIn.__name__.split('.')[-1], list(fields.keys()))
@@ -106,7 +106,7 @@ def Options(optionsList=None,mutable=False):
                 logEvent("IGNORING CONTEXT OPTION; DECLARE "+lvalue+" IF YOU WANT TO SET IT")
     #now set named tuple merging optionsList and opts_cli_dihelpct
     if mutable:
-        ContextOptions = recordtype("ContextOptions", iter(contextOptionsDict.items()))
+        ContextOptions = namedlist("ContextOptions", iter(contextOptionsDict.items()))
         return ContextOptions()
     else:
         ContextOptions = namedtuple("ContextOptions", list(contextOptionsDict.keys()))
diff --git a/proteus/defaults.py b/proteus/defaults.py
index e6b18bc698..08551ff44b 100644
--- a/proteus/defaults.py
+++ b/proteus/defaults.py
@@ -1,4 +1,4 @@
-import sys, recordtype, os, imp, copy, inspect
+import sys, namedlist, os, imp, copy, inspect
 from . import (TransportCoefficients,
                Transport,
                default_p,
@@ -52,10 +52,10 @@ def reraise(exc_type, exc_value, exc_traceback=None):
     else:
         physics_excluded_keys.append(k)
 
-_Physics_base = recordtype.recordtype('Physics_base',
-                                     [(k,default_p.__dict__[k])
-                                      for k in physics_default_keys],
-                                     use_slots=False)
+_Physics_base = namedlist.namedlist('Physics_base',
+                                   [(k,default_p.__dict__[k])
+                                    for k in physics_default_keys],
+                                   use_slots=False)
 class Physics_base(_Physics_base):
     __frozen = False
 
@@ -143,10 +143,10 @@ def load_physics(pModule, path='.'):
     else:
         numerics_excluded_keys.append(k)
 
-_Numerics_base = recordtype.recordtype('Numerics_base',
-                                      [(k,default_n.__dict__[k])
-                                       for k in numerics_default_keys],
-                                      use_slots=False)
+_Numerics_base = namedlist.namedlist('Numerics_base',
+                                    [(k,default_n.__dict__[k])
+                                     for k in numerics_default_keys],
+                                    use_slots=False)
 class Numerics_base(_Numerics_base):
     __frozen = False
 
@@ -212,10 +212,10 @@ def load_numerics(nModule, path='.'):
     else:
         system_excluded_keys.append(k)
 
-_System_base = recordtype.recordtype('System_base',
-                                    [(k,default_so.__dict__[k])
-                                     for k in system_default_keys],
-                                    use_slots=False)
+_System_base = namedlist.namedlist('System_base',
+                                  [(k,default_so.__dict__[k])
+                                   for k in system_default_keys],
+                                  use_slots=False)
 
 class System_base(_System_base):
     def __init__(self, **args):
